<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>KBridge 관부가세 계산기 v1.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>html,body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}</style>
</head>
<body class="bg-gradient-to-b from-white via-slate-50 to-blue-50 text-gray-900">
<div id="root"></div>

<script type="text/babel">
/* ============== Icons ============== */
const I= {
  clip:(p)=>(<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor"><path strokeWidth="1.5" d="M9 3.75h6A2.25 2.25 0 0 1 17.25 6v12A2.25 2.25 0 0 1 15 20.25H9A2.25 2.25 0 0 1 6.75 18V6A2.25 2.25 0 0 1 9 3.75z"/><path strokeWidth="1.5" d="M9.75 6.75h4.5"/></svg>),
  receipt:(p)=>(<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor"><path strokeWidth="1.5" d="M7 3.75h10.5a.75.75 0 0 1 .75.75V20l-2.25-1.5L13.75 20l-2.25-1.5L9.25 20 7 18.5 4.75 20V4.5a.75.75 0 0 1 .75-.75H7z"/><path strokeWidth="1.5" d="M8.75 7.75h6.5M8.75 11.25h6.5M8.75 14.75h4.5"/></svg>),
  refresh:(p)=>(<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor"><path strokeWidth="1.5" d="M4 7v4h4M20 17v-4h-4"/><path strokeWidth="1.5" d="M20 13a8 8 0 0 1-13.657 5.657M4 11a8 8 0 0 1 13.657-5.657"/></svg>),
  bolt:(p)=>(<svg {...p} viewBox="0 0 24 24" fill="currentColor"><path d="M13.5 1.5 3.75 13.5h6.75l-1.5 9 10.5-12h-6.75l.75-9z"/></svg>),
  usd:(p)=>(<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor"><path strokeWidth="1.5" d="M12 3v18M17 7.5c0-2-2.2-3-5-3s-5 1-5 3 2 3 5 3 5 1 5 3-2.2 3-5 3-5-1-5-3"/></svg>),
  ship:(p)=>(<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor"><path strokeWidth="1.5" d="M3 13l9-4 9 4M5 13v5.5a1.5 1.5 0 0 0 1.5 1.5H17.5A1.5 1.5 0 0 0 19 18.5V13"/><path strokeWidth="1.5" d="M7 19c2 0 2-1 4-1s2 1 4 1 2-1 4-1"/></svg>),
  shield:(p)=>(<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor"><path strokeWidth="1.5" d="M12 3l7 3v6c0 5-3.5 7.5-7 9-3.5-1.5-7-4-7-9V6l7-3z"/><path strokeWidth="1.5" d="M9 12l2 2 4-4"/></svg>),
  percent:(p)=>(<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor"><path strokeWidth="1.5" d="M19 5L5 19"/><circle cx="7.5" cy="7.5" r="2.5" strokeWidth="1.5"/><circle cx="16.5" cy="16.5" r="2.5" strokeWidth="1.5"/></svg>),
  bank:(p)=>(<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor"><path strokeWidth="1.5" d="M4 10h16M6 10v7m4-7v7m4-7v7m4-7v7M3 21h18M12 3l9 5H3l9-5z"/></svg>)
};

/* ============== Utils ============== */
const number = (v)=>{const n=parseFloat(String(v??"").replace(/,/g,""));return isNaN(n)?0:n};
const fmtKRW =(v)=> new Intl.NumberFormat("ko-KR",{maximumFractionDigits:0}).format(Math.round(v));
const fmtUSD =(v)=> new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(v);
const fmtThousandsStr=(raw)=>{if(raw==null)return"";const s=String(raw).replace(/,/g,"");if(s==="")return"";const p=s.split(".");const i=p[0]===""?"":Number(p[0]).toLocaleString("en-US");return p.length>1?`${i}.${p[1]}`:i};

/* ============== Small UI ============== */
const UI={tab:"h-7 md:h-8 px-2.5 text-[10px] md:text-[11px]",input:"h-9 px-3 text-sm",cardPad:"p-5 md:p-6",gap:"gap-4 md:gap-5",headline:"text-xl md:text-[22px]",badge:"inline-flex items-center rounded-md px-2 py-0.5 text-[11px] font-medium"};
const PAL={heading:"text-cyan-700", ring:"focus:ring-2 ring-offset-1 focus:ring-cyan-500"};

function SegmentedTabs({value,onChange,options}){
  return (
    <div className="w-full inline-flex rounded-lg border border-gray-300 bg-white shadow-sm overflow-hidden" role="tablist">
      {options.map((opt,i)=>{
        const active=value===opt.value;
        return(
          <button key={opt.value} type="button" role="tab" aria-selected={active}
            onClick={()=>onChange(opt.value)}
            className={`flex-1 min-w-0 text-center whitespace-nowrap ${UI.tab} transition ${active?"bg-cyan-600 text-white font-semibold":"bg-white text-gray-700 hover:bg-gray-50"} ${i>0?" border-l border-gray-300":""}`}>
            {opt.label}
          </button>
        );
      })}
    </div>
  );
}

function Row({label,value}){
  return(
    <div className="flex items-baseline justify-between text-sm md:text-base">
      <div className="text-gray-700">{label}</div>
      <div className="text-right font-semibold [font-variant-numeric:tabular-nums]">{value}</div>
    </div>
  );
}

function NumericInput({label,suffix,value,onChange,formatThousands=false,allowDecimal=true,disabled=false}){
  const [focused,setFocused]=React.useState(false);
  const handleChange=(e)=>{
    let s=e.target.value??""; s=s.replace(/,/g,""); s=s.replace(/[^\d.]/g,"");
    if(!allowDecimal){ s=s.replace(/\./g,"");} else {const parts=s.split("."); if(parts.length>2)s=parts[0]+"."+parts.slice(1).join("");}
    onChange(s);
  };
  const displayValue=formatThousands && !focused?fmtThousandsStr(value):value;
  return(
    <label className="block text-xs mb-1.5 w-full">
      <span className="block text-gray-800 font-medium mb-0.5 text-left text-xs">{label}</span>
      <div className="flex items-center gap-1">
        <input type="text" inputMode="decimal"
               className={`w-full rounded-md border border-gray-300 ${UI.input} shadow-sm text-right focus:outline-none ${PAL.ring} [font-variant-numeric:tabular-nums] h-9 px-2.5 py-1.5 text-sm`}
               value={displayValue} onChange={handleChange}
               onFocus={()=>setFocused(true)} onBlur={()=>setFocused(false)} disabled={disabled}/>
        {suffix && <span className="text-gray-600 font-medium whitespace-nowrap text-xs">{suffix}</span>}
      </div>
    </label>
  );
}

/* ============== App ============== */
function App(){
  const [priceUSD,setPriceUSD]=React.useState("0");
  const [freightUSD,setFreightUSD]=React.useState("0");
  const [insuranceUSD,setInsuranceUSD]=React.useState("20");
  const [autoInsurance,setAutoInsurance]=React.useState(true);

  const [exchangeRate,setExchangeRate]=React.useState("1350");
  const [autoRate,setAutoRate]=React.useState(true);
  const [rateStatus,setRateStatus]=React.useState("idle"); // idle|loading|ok_unipass|ok_unipass_cached|error
  const [rateDate,setRateDate]=React.useState(null);

  const [dutyRatePct,setDutyRatePct]=React.useState("8");
  const [vatRatePct,setVatRatePct]=React.useState("10");
  const [origin,setOrigin]=React.useState("OTHER"); // OTHER|US
  const [otherTaxesKRW,setOtherTaxesKRW]=React.useState("0");

  const autoIns=React.useMemo(()=>{
    const p=number(priceUSD); const guess=p*1.1*0.0003; // 0.03%
    return Math.max(20, isNaN(guess)?0:guess);
  },[priceUSD]);
  const insurance=autoInsurance?autoIns:number(insuranceUSD);

  const cifUSD=number(priceUSD)+number(freightUSD)+(isNaN(insurance)?0:insurance);
  const rate=number(exchangeRate);
  const cifKRW=cifUSD*rate;

  const dutyRate=number(dutyRatePct)/100;
  const vatRate=number(vatRatePct)/100;
  const otherTaxes=number(otherTaxesKRW);

  const thresholdUSD=origin==="US"?200:150;
  const isDeMinimis=cifUSD>0 && cifUSD<=thresholdUSD;

  const dutyKRW=isDeMinimis?0:cifKRW*dutyRate;
  const vatBaseKRW=isDeMinimis?0:Math.max(0,cifKRW+dutyKRW+otherTaxes);
  const vatKRW=isDeMinimis?0:vatBaseKRW*vatRate;
  const totalTaxKRW=dutyKRW+vatKRW+(isDeMinimis?0:otherTaxes);
  const landedCostKRW=cifKRW+totalTaxKRW;

  /* ===== 유니패스 주간환율(USD, 과세환율) — 오늘 주간 고정 ===== */
  const CACHE_KEY="kb_unipass_usdkrw_v1";

  const saveCache=(rate,date)=>{
    try{ localStorage.setItem(CACHE_KEY, JSON.stringify({rate, date, ts:Date.now()})); }catch(_){}
  };
  const loadCache=()=>{
    try{ const s=localStorage.getItem(CACHE_KEY); if(!s) return null; return JSON.parse(s);}catch(_){ return null;}
  };

  function todayISO(){
    const d=new Date(); const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,"0"), day=String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }

  async function fetchTextWithTimeout(url, ms=8000){
    const ctrl=new AbortController(); const t=setTimeout(()=>ctrl.abort(), ms);
    try{
      const res=await fetch(url,{signal:ctrl.signal, cache:"no-store"});
      if(!res.ok) throw new Error("HTTP "+res.status);
      return await res.text();
    }finally{ clearTimeout(t); }
  }

  function parseUnipassUSD(html){
    // 1) DOM 파싱 시도
    const doc=new DOMParser().parseFromString(html,"text/html");
    // 결과 테이블의 행 중 'USD' 포함된 행 탐색
    let rows=[...doc.querySelectorAll("tr")];
    let usdRow=rows.find(tr=>/USD/i.test(tr.textContent||""));
    let val=NaN;
    if(usdRow){
      const headers=[...doc.querySelectorAll("thead th")].map(th=>(th.textContent||"").trim());
      let idx=headers.findIndex(h=>h.includes("과세"));
      const tds=[...usdRow.querySelectorAll("td")];
      if(idx>=0 && tds[idx]){
        val=parseFloat((tds[idx].textContent||"").replace(/,/g,""));
      }
      // 보강: 숫자만 추출해 맨 마지막(보통 ‘과세환율’) 사용
      if(!isFinite(val)){
        const nums=((usdRow.textContent||"").match(/[\d,]+(?:\.\d+)?/g)||[]).map(s=>parseFloat(s.replace(/,/g,"")));
        if(nums.length>=1) val=nums[nums.length-1];
      }
    }
    // 2) 정규식 보강 (혹시 tr 탐색이 안될 때)
    if(!isFinite(val)){
      const m=html.match(/USD[\s\S]{0,200}?([\d,]+(?:\.\d+)?)(?![\s\S]*USD)/i);
      if(m) val=parseFloat(m[1].replace(/,/g,""));
    }
    if(!isFinite(val)) throw new Error("Unipass parse failed");
    return Math.round(val);
  }

  const fetchUnipassRate=React.useCallback( async ()=>{
    setRateStatus("loading");
    try{
      // 적용기간=오늘(페이지 기본이 '오늘이 속한 주'), 통화코드=USD 고정
      const url="https://r.jina.ai/https://unipass.customs.go.kr/clip/com/bsopcomn/baseinfo/otsd/COM0101049Q.do";
      const html=await fetchTextWithTimeout(url, 10000);
      const val=parseUnipassUSD(html); // USD 과세환율
      if(val && isFinite(val)){
        const iso=todayISO();
        setExchangeRate(String(val));
        setRateDate(iso);
        setRateStatus("ok_unipass");
        saveCache(val, iso);
        return;
      }
      throw new Error("empty");
    }catch(_){
      setRateStatus("error");
    }
  },[]);

  // 초기: 캐시 먼저 → 자동 갱신
  React.useEffect(()=>{
    const c=loadCache();
    if(c && c.rate){
      setExchangeRate(String(c.rate));
      setRateDate(c.date||null);
      setRateStatus("ok_unipass_cached");
    }
    if(autoRate){ fetchUnipassRate(); }
  },[autoRate,fetchUnipassRate]);

  /* ============== Render ============== */
  const badgeCls = rateStatus==="ok_unipass" ? "bg-emerald-100 text-emerald-700"
                  : rateStatus==="ok_unipass_cached" ? "bg-sky-100 text-sky-700"
                  : rateStatus==="loading" ? "bg-amber-100 text-amber-700"
                  : "bg-rose-100 text-rose-700";

  const badgeText = rateStatus==="ok_unipass" ? "유니패스 적용"
                   : rateStatus==="ok_unipass_cached" ? "유니패스 캐시"
                   : rateStatus==="loading" ? "조회 중"
                   : "오류";

  return (
    <div className="min-h-screen text-gray-900 [font-variant-numeric:tabular-nums]">
      {/* Header */}
      <header className="sticky top-0 z-10 bg-white/80 backdrop-blur border-b shadow-sm">
        <div className="max-w-5xl mx-auto px-3 py-2 md:px-4 md:py-3 flex items-center justify-between">
          <div>
            <h1 className={`font-extrabold ${UI.headline} ${PAL.heading} tracking-tight`}>
              KBridge 관부가세 계산기 <span className="text-xs ml-1 text-gray-500">v1.0</span>
            </h1>
            <p className="text-xs text-gray-600 mt-1">유니패스(USD 과세환율) 자동 반영 · 숫자 쉼표 · 보험 자동계산</p>
          </div>
</div>
      </header>

      {/* Content */}
      <main className={`max-w-5xl mx-auto px-4 py-6 grid grid-cols-1 lg:grid-cols-2 ${UI.gap} items-start`}>
        {/* 입력 */}
        <section className={`bg-white rounded-2xl shadow ${UI.cardPad} border border-gray-100`}>
          <div className="flex items-center gap-2 mb-3">
            <span className="p-2 rounded-xl bg-cyan-100 text-cyan-700"><I.clip className="w-4 h-4"/></span>
            <h2 className={`${UI.headline} font-semibold ${PAL.heading} text-sm md:text-base`}>입력</h2>
          </div>
          {/* 1행: 동일 행 하단 정렬 */}
          <div className={`grid grid-cols-1 sm:grid-cols-2 ${UI.gap} mb-2 items-end`}>
            <div className="flex flex-col">
              <span className="block text-gray-800 font-medium mb-0.5 text-left text-xs text-sm">원산지/발송국가</span>
              <SegmentedTabs value={origin} onChange={setOrigin}
                options={[{value:"OTHER",label:"기타 국가"},{value:"US",label:"미국(US) 발송"}]}/>
              <p className="text-[11px] text-gray-500 mt-1 text-left">면세 기준: {origin==="US"?"USD 200":"USD 150"}</p>
            </div>

            <div className="flex flex-col sm:col-span-2">
              <NumericInput
                label={<span className="inline-flex items-center gap-2">
                  환율 (원/달러)
                  <span className={`${UI.badge} ${badgeCls}`}>{badgeText}</span>
                </span>}
                value={exchangeRate} onChange={setExchangeRate} suffix="KRW/USD"
                formatThousands allowDecimal={false} disabled={autoRate}
              />
              <div className="flex items-center justify-between mt-1">
                <label className="inline-flex items-center gap-1 text-sm select-none">
                  <input className="h-4 w-4" type="checkbox" checked={autoRate} onChange={e=>setAutoRate(e.target.checked)}/>
                  <span className="inline-flex items-center gap-1 text-gray-700"><I.bolt className="w-3.5 h-3.5 text-cyan-600"/>자동 환율(관세청 고시)</span>
                </label>
                <button type="button" onClick={fetchUnipassRate} className="inline-flex items-center gap-1 text-sm text-cyan-700 hover:text-cyan-800">
                  <I.refresh className="w-4 h-4"/>새로고침
                </button>
              </div>
              {rateDate && <p className="text-[11px] text-gray-500 mt-1">기준일: {rateDate} (Uni-Pass 주간환율)</p>}
            </div>
          </div>

          <div className={`grid grid-cols-1 sm:grid-cols-3 ${UI.gap}`}>
            <NumericInput label={<span className="inline-flex items-center gap-1"><I.usd className="w-4 h-4 text-cyan-600"/>물품가격</span>}
              value={priceUSD} onChange={setPriceUSD} suffix="USD" formatThousands allowDecimal/>
            <NumericInput label={<span className="inline-flex items-center gap-1"><I.ship className="w-4 h-4 text-cyan-600"/>운송료</span>}
              value={freightUSD} onChange={setFreightUSD} suffix="USD" formatThousands allowDecimal/>
            <NumericInput
              label={<span className="inline-flex items-center gap-1">{autoInsurance?<I.shield className="w-4 h-4 text-emerald-600"/>:<I.shield className="w-4 h-4 text-cyan-600"/>}{autoInsurance?"자동 계산값":"보험료"}</span>}
              value={autoInsurance?fmtThousandsStr(String(Math.max(20,(number(priceUSD)*1.1*0.0003)||0))):insuranceUSD}
              onChange={setInsuranceUSD} suffix="USD" formatThousands allowDecimal  disabled={autoInsurance}/>
          </div>

          <div className="mt-2">
            <label className="flex items-center gap-2 text-sm select-none">
              <input className="h-4 w-4" type="checkbox" checked={autoInsurance} onChange={e=>setAutoInsurance(e.target.checked)}/>
              보험 자동계산 사용(최소 $20)
            </label>
          </div>

          <div className={`mt-4 grid grid-cols-1 sm:grid-cols-3 ${UI.gap}`}>
            <NumericInput label={<span className="inline-flex items-center gap-1"><I.percent className="w-4 h-4 text-cyan-600"/>관세율</span>}
              value={dutyRatePct} onChange={setDutyRatePct} suffix="%" allowDecimal/>
            <NumericInput label={<span className="inline-flex items-center gap-1"><I.receipt className="w-4 h-4 text-cyan-600"/>부가세율</span>}
              value={vatRatePct} onChange={setVatRatePct} suffix="%" allowDecimal/>
            <NumericInput label={<span className="inline-flex items-center gap-1"><I.bank className="w-4 h-4 text-cyan-600"/>기타 세액</span>}
              value={otherTaxesKRW} onChange={setOtherTaxesKRW} suffix="KRW" formatThousands allowDecimal={false}/>
          </div>
        </section>





        
        

    
        {/* 결과 */}
        <section className={`bg-white rounded-2xl shadow ${UI.cardPad} border border-gray-100 lg:sticky lg:top-24`}>
          <div className="flex items-center gap-2 mb-3">
            <span className="p-2 rounded-xl bg-cyan-100 text-cyan-700"><I.receipt className="w-4 h-4"/></span>
            <h2 className={`${UI.headline} font-semibold ${PAL.heading} text-sm md:text-base`}>결과</h2>
          </div>

          <div className="space-y-2">
            <div className="rounded-2xl border p-3 bg-gradient-to-r from-cyan-50 to-blue-50">
              <div className="flex items-baseline justify-between text-xs font-bold text-gray-800">
                <span>총 과세가격 (CIF)</span>
                <span className="text-right text-base md:text-sm [font-variant-numeric:tabular-nums]">{fmtUSD(cifUSD)} USD</span>
              </div>
              <div className="flex items-baseline justify-between mt-1 text-xs text-gray-600">
                <span>환산</span>
                <span className="text-right text-base md:text-sm [font-variant-numeric:tabular-nums]">{fmtKRW(cifKRW)} 원</span>
              </div>
            </div>

            {isDeMinimis && (
              <div className="rounded-2xl border border-emerald-200 p-4 bg-emerald-50 text-emerald-900 font-medium text-center text-xs">
                면세 추정: CIF가 {origin==="US"?"USD 200":"USD 150"} 이하
              </div>
            )}

            <div className={`grid grid-cols-1 sm:grid-cols-2 ${UI.gap}`}>
              <div className="rounded-2xl border p-3 bg-gray-50"><Row label="관세" value={<>{fmtKRW(dutyKRW)} 원</>} /></div>
              <div className="rounded-2xl border p-3 bg-gray-50"><Row label="부가세" value={<>{fmtKRW(vatKRW)} 원</>} /></div>
            </div>

            {number(otherTaxesKRW)>0 && (<div className="rounded-2xl border p-3 bg-gray-50"><Row label="기타 세액" value={<>{fmtKRW(number(otherTaxesKRW))} 원</>} /></div>)}

            <div className="rounded-3xl p-3 text-white shadow-xl bg-gradient-to-r from-cyan-600 to-blue-600">
              <div className="flex justify-between items-baseline text-xs">
                <span className="font-semibold">총 세액</span>
                <span className="text-right text-base md:text-sm font-extrabold text-2xl [font-variant-numeric:tabular-nums]">{fmtKRW(totalTaxKRW)} 원</span>
              </div>
              <div className="flex justify-between items-baseline text-xs mt-2">
                <span className="font-semibold">도착원가</span>
                <span className="text-right text-base md:text-sm font-extrabold text-2xl [font-variant-numeric:tabular-nums]">{fmtKRW(landedCostKRW)} 원</span>
              </div>
            </div>

            <details open className="rounded-2xl border p-3 bg-gray-50">
              <summary className="cursor-pointer font-medium text-cyan-700 py-1.5 text-sm">계산 내역 보기</summary>
              <ul className="text-xs text-gray-700 mt-3 space-y-1 list-disc ml-5">
                <li>CIF(USD) = 물품가 + 운송료 + 보험</li>
                <li>CIF(KRW) = CIF(USD) × 환율</li>
                <li>관세 = CIF(KRW) × 관세율</li>
                <li>부가세 = (CIF+관세+기타세액) × 부가세율</li>
              </ul>
            </details>

            <p className="text-xs text-gray-500 mt-1 text-left">
              ※ 환율 출처: 관세청 유니패스 주간환율(USD·과세환율). 네트워크/정책으로 조회 실패 시 ‘오류’로 표시되며 수동 입력으로 계속 사용 가능합니다.
            </p>
          </div>
        </section>

{/* 사용방법 */}
<section className={`bg-white rounded-2xl shadow ${UI.cardPad} border border-gray-100 lg:col-start-1 lg:row-start-2 lg:col-span-1 lg:-mt-6`}>
      <div className="flex items-center gap-2 mb-3">
        <span className="p-2 rounded-xl bg-cyan-100 text-cyan-700">
          <svg className="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M13.5 1.5 3.75 13.5h6.75l-1.5 9 10.5-12h-6.75l.75-9z"/></svg>
        </span>
        <h2 className="text-lg md:text-[22px] font-semibold text-cyan-700 text-sm md:text-base">사용방법</h2>
      </div>

      <details className="rounded-2xl border p-3 bg-gray-50">
        <summary className="cursor-pointer font-medium text-cyan-700">빠른 시작 (간략)</summary>
        <ol className="mt-3 list-decimal ml-5 text-xs text-gray-700 space-y-1">
          <li><b>원산지/발송국가</b>를 선택합니다. (미국: 면세 USD 200, 기타: USD 150)</li>
          <li><b>HS CODE 검색</b>에 코드 일부(최소 4자리)를 입력 → 제안에서 선택합니다.<br/>체크박스 <b>“HS 코드로 관세율 자동 적용”</b>이 ON이면 관세율이 자동으로 채워집니다.</li>
          <li>HS 선택 순간 <b>자동 환율</b>이 켜져 있고 환율 상태가 <i>idle/error</i>면, <b>유니패스 과세환율</b>을 자동 조회합니다.</li>
          <li><b>물품가격·운송료·보험료</b>를 USD로 입력합니다. (보험 자동계산 ON 시 자동 반영, 최소 $20)<br/>
              <span className="text-[11px] text-gray-500">물품가격 × 110% × 0.03% 적용된 값 입니다. <b>(단, MINIMUM. $20 적용)</b> 적하보험 진행 시만 포함되며, 보험사 요율에 따라 차이가 있을 수 있습니다.</span>
          </li>
          <li>필요 시 <b>부가세율·기타세액</b>을 조정합니다.</li>
          <li>우측에서 <b>관세·부가세·총 세액</b>과 <b>도착원가</b>를 확인합니다.</li>
        </ol>
      </details>

      <details className="rounded-2xl border p-3 bg-gray-50 mt-3">
        <summary className="cursor-pointer font-medium text-cyan-700">HS CODE 검색 & 자동 관세율</summary>
        <ul className="mt-3 list-disc ml-5 text-xs text-gray-700 space-y-1">
          <li>검색은 숫자만 인식하며, 상위 <b>30개</b>까지 제안됩니다.</li>
          <li>매칭 규칙: <b>10→9→…→6자리</b> 최장 일치 우선 매칭.</li>
          <li>품명/설명이 있는 경우, 선택 후 하단에 <code>[코드]</code>와 함께 간단히 표시됩니다.</li>
          <li>특혜/FTA와 같은 <b>다른 세율 컬럼</b>으로 바꾸려면 알려주세요. 해당 컬럼 기준으로 다시 매핑해 드립니다.</li>
        </ul>
      </details>

      <details className="rounded-2xl border p-3 bg-gray-50 mt-3">
        <summary className="cursor-pointer font-medium text-cyan-700">자동 환율 (유니패스·대체·캐시)</summary>
        <ul className="mt-3 list-disc ml-5 text-xs text-gray-700 space-y-1">
          <li><b>유니패스 과세환율</b> 조회(프록시 경유) → DOM/정규식 이중 파싱, <b>500~5000 KRW</b> 합리성 체크.</li>
          <li>실패 시 <b>시장환율(대체)</b> 적용: exchangerate.host → open.er-api.com. 배지에 “시장환율(대체)”로 명시.</li>
          <li>그래도 실패하면 <b>로컬 캐시</b>를 사용(있을 때). 배지: “유니패스 캐시”.</li>
          <li>상단 버튼 <b>“새로고침”</b>으로 재조회 가능, 탭이 다시 보일 때도 자동 재시도.</li>
        </ul>
      </details>

      <details className="rounded-2xl border p-3 bg-gray-50 mt-3">
        <summary className="cursor-pointer font-medium text-cyan-700">계산식 & 기타</summary>
        <ul className="mt-3 list-disc ml-5 text-xs text-gray-700 space-y-1">
          <li>CIF(USD) = 물품가 + 운송료 + 보험(자동계산 ON 시 최소 $20, 위험률 0.03%·해상 10% 가정)</li>
          <li>CIF(KRW) = CIF(USD) × 환율</li>
          <li>관세 = CIF(KRW) × 관세율</li>
          <li>부가세 = (CIF + 관세 + 기타세액) × 부가세율</li>
          <li>면세 기준: 기타국가 USD 150, 미국 USD 200 (CIF 기준)</li>
          <li>입력칸 크기: 모두 <b>환율 입력칸과 동일</b>하게 통일되어 있습니다.</li>
        </ul>
      </details>
</section>





      </main>
</div>
  );
}

const root=ReactDOM.createRoot(document.getElementById("root"));
root.render(<App/>);
</script>
</body>
</html>
